(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))l(c);new MutationObserver(c=>{for(const i of c)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function e(c){const i={};return c.integrity&&(i.integrity=c.integrity),c.referrerPolicy&&(i.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?i.credentials="include":c.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(c){if(c.ep)return;c.ep=!0;const i=e(c);fetch(c.href,i)}})();const f=t=>document.querySelector(t),v=f("#drop"),E=f("#file"),S=f("#step"),T=f("#topn"),R=f("#k"),A=f("#analyze"),z=f("#downloadCsv"),D=f("#quantize"),k=f("#exportGpl"),y=f("#meta"),I=f("#grid"),U=f("#preview"),w=f("#cv"),L=w.getContext("2d");let N=null,$=null,M=null;const j=1600,B=(t,n,e)=>"#"+[t,n,e].map(l=>l.toString(16).padStart(2,"0")).join("").toUpperCase(),C=(t,n)=>Math.min(255,Math.round(t/n)*n);function F(t){let n=t.naturalWidth||t.width,e=t.naturalHeight||t.height;if(Math.max(n,e)>j){const l=j/Math.max(n,e);n=Math.round(n*l),e=Math.round(e*l)}w.width=n,w.height=e,L.clearRect(0,0,n,e),L.drawImage(t,0,0,n,e)}function P(t){I.innerHTML="";for(const n of t){const e=document.createElement("div");e.className="item";const l=document.createElement("div");l.className="sw",l.style.background=n.hex,l.title="Kopyala",l.addEventListener("click",()=>G(n.hex));const c=document.createElement("div");c.innerHTML=`<b>${n.hex}</b> <span class="muted">• ${(n.ratio*100).toFixed(2)}% • ${n.count} px</span>`,e.appendChild(l),e.appendChild(c),I.appendChild(e)}}async function G(t){try{await navigator.clipboard.writeText(t),y.textContent=`${t} kopyalandı`}catch{y.textContent="Kopyalama başarısız"}}function K(t=1,n=100){const{data:e,width:l,height:c}=L.getImageData(0,0,w.width,w.height),i=l*c,a=Math.max(1,Number(t)||1),d=new Map;for(let h=0;h<e.length;h+=4){let p=e[h],b=e[h+1],s=e[h+2];if(e[h+3]===0)continue;a>1&&(p=C(p,a),b=C(b,a),s=C(s,a));const o=p<<16|b<<8|s;d.set(o,(d.get(o)??0)+1)}const g=[];for(const[h,p]of d.entries()){const b=h>>16&255,s=h>>8&255,r=h&255;g.push({hex:B(b,s,r),r:b,g:s,b:r,count:p,ratio:p/i})}g.sort((h,p)=>p.count-h.count),$=g,P(g.slice(0,Math.min(n,g.length))),y.textContent=`Piksel: ${i.toLocaleString("tr-TR")} • Benzersiz: ${g.length.toLocaleString("tr-TR")} • Hassasiyet:${a}`,z.disabled=g.length===0,k.disabled=!0}function q(t,n){const e=`hex,r,g,b,count,ratio
`,l=t.map(d=>`${d.hex},${d.r},${d.g},${d.b},${d.count},${d.ratio.toFixed(6)}`).join(`
`),c=new Blob([e+l],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(c),a=document.createElement("a");a.href=i,a.download=n,a.click(),URL.revokeObjectURL(i)}function Q(t,n="palette"){const e=["GIMP Palette",`Name: ${n}`,"Columns: 0","# R G B  Name"];t.forEach(a=>e.push(`${a.r} ${a.g} ${a.b}	${a.hex}`));const l=new Blob([e.join(`
`)],{type:"text/plain;charset=utf-8;"}),c=URL.createObjectURL(l),i=document.createElement("a");i.href=c,i.download=`${n}.gpl`,i.click(),URL.revokeObjectURL(c)}function _(t=16,n=5,e=8){const{data:l,width:c,height:i}=L.getImageData(0,0,w.width,w.height),a=[];for(let s=0;s<i;s+=n)for(let r=0;r<c;r+=n){const o=(s*c+r)*4;l[o+3]!==0&&a.push([l[o],l[o+1],l[o+2]])}if(!a.length)return[];const d=[];for(let s=0;s<t;s++){const r=a[Math.random()*a.length|0];d.push([r[0],r[1],r[2]])}const g=new Array(a.length).fill(0),h=(s,r)=>{const o=s[0]-r[0],u=s[1]-r[1],m=s[2]-r[2];return o*o+u*u+m*m};for(let s=0;s<e;s++){for(let o=0;o<a.length;o++){let u=0,m=1/0;for(let x=0;x<d.length;x++){const O=h(a[o],d[x]);O<m&&(m=O,u=x)}g[o]=u}const r=Array.from({length:t},()=>[0,0,0,0]);for(let o=0;o<a.length;o++){const u=g[o],m=a[o];r[u][0]+=m[0],r[u][1]+=m[1],r[u][2]+=m[2],r[u][3]++}for(let o=0;o<t;o++)if(r[o][3]>0)d[o][0]=Math.round(r[o][0]/r[o][3]),d[o][1]=Math.round(r[o][1]/r[o][3]),d[o][2]=Math.round(r[o][2]/r[o][3]);else{const u=a[Math.random()*a.length|0];d[o]=[u[0],u[1],u[2]]}}const p=new Array(t).fill(0);for(const s of g)p[s]++;return d.map((s,r)=>({hex:B(s[0],s[1],s[2]),r:s[0],g:s[1],b:s[2],count:p[r],ratio:p[r]/(a.length||1)})).sort((s,r)=>r.count-s.count)}function H(t){const n=t?.[0];if(!n)return;const e=new Image;e.src=URL.createObjectURL(n),e.onload=()=>{N=e,U.src=e.src,U.style.display="block",F(e),y.textContent=`Yüklendi: ${n.name} (${e.width}×${e.height})`,I.innerHTML="",$=null,M=null,z.disabled=!0,k.disabled=!0}}v.addEventListener("click",()=>E.click());v.addEventListener("dragover",t=>{t.preventDefault(),v.style.background="#fafafa"});v.addEventListener("dragleave",()=>v.style.background="");v.addEventListener("drop",t=>{t.preventDefault(),v.style.background="",H(t.dataTransfer?.files||null)});E.addEventListener("change",()=>H(E.files));A.addEventListener("click",()=>{if(!N){y.textContent="Önce görsel seçin.";return}K(Number(S.value||1),Number(T.value||100))});z.addEventListener("click",()=>{$&&q($,"colors_all.csv")});D.addEventListener("click",()=>{if(!N){y.textContent="Önce görsel seçin.";return}const t=_(Number(R.value||16),5,8);M=t,k.disabled=t.length===0,P(t),y.textContent=`Quantize K=${R.value} (örneklem)`});k.addEventListener("click",()=>{M&&Q(M,`palette_K${R.value}`)});
